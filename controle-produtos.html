<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ebenézer Controle de Produtos</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f5f5f5; }
    h1 { color: #0084ff; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background-color: #0084ff; color: white; }
    button { padding: 5px 10px; margin: 2px; cursor: pointer; }
    input { padding: 5px; margin: 5px 0; width: 200px; }
    .container { max-width: 800px; margin: auto; }
  </style>
</head>
<body>
    <script src="./js/ebz-theme.js" defer></script>

  <div class="container">
    <h1>Controle de Produtos Ebenézer</h1>

    <h2>Adicionar Produto</h2>
    <input type="text" id="nomeProduto" placeholder="Nome do produto">
    <input type="number" id="quantidadeProduto" placeholder="Quantidade">
    <input type="number" id="precoProduto" placeholder="Preço">
    <button onclick="adicionarProduto()">Adicionar</button>

    <h2>Estoque</h2>
    <table id="tabelaEstoque">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Quantidade</th>
          <th>Preço</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>Produtos Vendidos</h2>
    <table id="tabelaVendas">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Quantidade Vendida</th>
          <th>Preço</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

    // Config do Firebase
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_AUTH_DOMAIN",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_STORAGE_BUCKET",
      messagingSenderId: "SEU_MESSAGING_SENDER_ID",
      appId: "SEU_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const estoqueRef = collection(db, "estoque");
    const vendasRef = collection(db, "vendas");

    async function atualizarTabelas() {
      const tbodyEstoque = document.querySelector("#tabelaEstoque tbody");
      const tbodyVendas = document.querySelector("#tabelaVendas tbody");
      tbodyEstoque.innerHTML = "";
      tbodyVendas.innerHTML = "";

      const produtos = await getDocs(estoqueRef);
      produtos.forEach(prod => {
        const p = prod.data();
        tbodyEstoque.innerHTML += `
          <tr>
            <td>${p.nome}</td>
            <td>${p.quantidade}</td>
            <td>R$ ${p.preco.toFixed(2)}</td>
            <td>
              <button onclick="venderProduto('${prod.id}', ${p.quantidade})">Vender</button>
              <button onclick="removerProduto('${prod.id}')">Remover</button>
            </td>
          </tr>
        `;
      });

      const vendas = await getDocs(vendasRef);
      vendas.forEach(v => {
        const p = v.data();
        tbodyVendas.innerHTML += `
          <tr>
            <td>${p.nome}</td>
            <td>${p.quantidade}</td>
            <td>R$ ${p.preco.toFixed(2)}</td>
          </tr>
        `;
      });
    }

    async function adicionarProduto() {
      const nome = document.getElementById("nomeProduto").value;
      const quantidade = parseInt(document.getElementById("quantidadeProduto").value);
      const preco = parseFloat(document.getElementById("precoProduto").value);

      if(nome && quantidade > 0 && preco >= 0){
        await addDoc(estoqueRef, { nome, quantidade, preco });
        document.getElementById("nomeProduto").value = "";
        document.getElementById("quantidadeProduto").value = "";
        document.getElementById("precoProduto").value = "";
        atualizarTabelas();
      } else {
        alert("Preencha todos os campos corretamente!");
      }
    }

    async function venderProduto(id, quantidadeAtual) {
      if(quantidadeAtual > 0){
        const produtoDoc = doc(db, "estoque", id);
        const produtoData = (await getDoc(produtoDoc)).data();

        await updateDoc(produtoDoc, { quantidade: quantidadeAtual - 1 });

        const vendasSnapshot = await getDocs(vendasRef);
        let vendaExistente = null;
        vendasSnapshot.forEach(v => {
          if(v.data().idProduto === id) vendaExistente = v;
        });

        if(vendaExistente){
          const vDoc = doc(db, "vendas", vendaExistente.id);
          await updateDoc(vDoc, { quantidade: vendaExistente.data().quantidade + 1 });
        } else {
          await addDoc(vendasRef, { nome: produtoData.nome, quantidade: 1, preco: produtoData.preco, idProduto: id });
        }

        atualizarTabelas();
      } else {
        alert("Produto esgotado!");
      }
    }

    async function removerProduto(id) {
      await deleteDoc(doc(db, "estoque", id));
      atualizarTabelas();
    }

    atualizarTabelas();
  </script>

</body>
<a id="iconeControle" href="controle-produtos.html" title="Controle de Produtos">
  <svg>...</svg>
</a>
</html>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{--brand:#0084FF;--text:#2c2c2c}
body{font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;background:#f5f5f5;color:var(--text)}

/* Navbar + Drawer */
.navbar{background:#000;padding:1rem 2rem;position:sticky;top:0;z-index:1000;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,.3)}
.logo{font-size:2rem;font-weight:bold;color:var(--brand)} .logo span{color:#fff}
nav{display:flex;align-items:center}
nav ul{display:flex;list-style:none;gap:1.8rem}
nav ul li a{color:#fff;text-decoration:none;display:inline-flex;align-items:center;gap:.6rem;font-weight:500;transition:.2s}
nav ul li a:hover{font-weight:bold;transform:translateY(-3px)}
.nav-ico{width:20px;height:20px;display:none;color:#fff}
.menu-button{display:none;font-size:2rem;color:#fff;cursor:pointer;user-select:none}
.nav-icon-container{display:flex;align-items:center;position:relative}
.cart-counter{position:absolute;top:-5px;right:-5px;background:red;color:#fff;font-size:13px;padding:3px 7px;border-radius:50%;font-weight:bold}
.nav-overlay{display:none}

@media(max-width:800px){
  nav{position:fixed;top:0;right:0;height:100dvh;width:min(86vw,360px);background:#111;padding-top:74px;transform:translateX(100%);transition:transform .3s ease;box-shadow:-12px 0 28px rgba(0,0,0,.35);z-index:1002}
  nav.show-menu{transform:translateX(0)}
  .menu-button{display:block}
  .nav-overlay{display:block;position:fixed;inset:0;background:rgba(0,0,0,.4);opacity:0;pointer-events:none;transition:opacity .3s ease;z-index:1001}
  .nav-overlay.active{opacity:1;pointer-events:auto}
  nav ul{display:flex;flex-direction:column;gap:0}
  nav ul li{border-bottom:1px solid rgba(255,255,255,.08)}
  nav ul li a{padding:1rem 1.25rem;width:100%}
  .nav-ico{display:inline-block}
}

/* Conteúdo genérico */
header{background:linear-gradient(135deg,#104372,#0f7794);padding:2.2rem 1rem;color:#fff;text-align:center}
header h1{font-size:clamp(1.5rem,4vw,2.4rem)}
.container{max-width:1100px;margin:2rem auto;padding:0 1rem}
.card{background:#fff;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.08);padding:1.2rem;margin-top:1rem}
.grid{display:grid;gap:1rem}
.grid-2{grid-template-columns:repeat(2,1fr)}
@media(max-width:800px){.grid-2{grid-template-columns:1fr}}
.btn{border:none;background:var(--brand);color:#fff;font-weight:bold;padding:.7rem 1.2rem;border-radius:10px;cursor:pointer;transition:.2s;text-decoration:none;display:inline-block}
.btn:hover{background:#005bb5}
.btn-outline{background:#fff;color:#005bb5;border:2px solid #cfe3ff}

/* Footer */
footer{background:#000;color:#fff;text-align:center;padding:2rem;margin-top:2rem}
footer h1{font-size:2rem}
footer h1 span{color:#fff}
</style>
